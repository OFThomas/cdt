\hypertarget{namespacemakeopticalelements}{}\section{makeopticalelements Module Reference}
\label{namespacemakeopticalelements}\index{makeopticalelements@{makeopticalelements}}


module for building symplectic matrices for optical elements  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
subroutine \hyperlink{namespacemakeopticalelements_a593a6ee34afdeebc8b4667791c8a144f}{make\+\_\+bs} (nspace, nspec, symp\+\_\+mat, m1, m2, theta)
\begin{DoxyCompactList}\small\item\em makes beamsplitter symplectic matrix  takes in an allocated matrix for the beamsplitter matrix to be written to uses the private ident\+\_\+spec, spatial\+\_\+work, n\+\_\+work arrays \end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemakeopticalelements_a6658c2ce879c0bc4b2e5918064a6a308}{make\+\_\+sq} (nspace, nspec, symp\+\_\+mat, m1, m2, alpha, beta)
\begin{DoxyCompactList}\small\item\em make symplectic squeezing matrix from exponetiated J\+SA  a lot is broken... \end{DoxyCompactList}\item 
complex(kind=dp) function, dimension(\+:,\+:), allocatable \hyperlink{namespacemakeopticalelements_ae72bdfe443e711e230a7bf9c19d827d4}{make\+\_\+squeezer} (nspace, nspec, mode1, mode2, jsa)
\begin{DoxyCompactList}\small\item\em make sqq matrix from jsa function \end{DoxyCompactList}\item 
real(kind=dp) function, dimension(\+:,\+:), allocatable \hyperlink{namespacemakeopticalelements_a230fa3e5fad58bf78ec6aecff5747ca6}{gen\+\_\+jsa} (f, w1\+\_\+start, w1\+\_\+steps, w1\+\_\+incr, w2\+\_\+start, w2\+\_\+steps, w2\+\_\+incr, sigma1, sigma2, outfile, w1offset, w2offset)
\begin{DoxyCompactList}\small\item\em samples the given jsa for frequency ranges w1, w2 \end{DoxyCompactList}\item 
complex(kind=dp) function \hyperlink{namespacemakeopticalelements_ae29454e6b6a33b50212c3af0c275173a}{f\+\_\+gauss} (w1, w2, sigma1, sigma2, w1off, w2off)
\begin{DoxyCompactList}\small\item\em J\+SA function taking two freq. \end{DoxyCompactList}\item 
complex(kind=dp) function \hyperlink{namespacemakeopticalelements_ac31d9c650a776cc4ebd4de3bcc370207}{f\+\_\+sine} (w1, w2, sigma1, sigma2, w1off, w2off)
\item 
real(kind=dp) function \hyperlink{namespacemakeopticalelements_af1a18704c55aa2efeb60157c81a80723}{g4} (ft, nspec)
\begin{DoxyCompactList}\small\item\em calculates g4 using matrix elements sum  \end{DoxyCompactList}\item 
real(kind=dp) function \hyperlink{namespacemakeopticalelements_a0649740479f47221d009b8d496b78c8b}{amp} (a)
\begin{DoxyCompactList}\small\item\em returns the absolute value squared $\vert$a$\vert$$\ast$$\ast$2 \end{DoxyCompactList}\item 
complex(kind=dp) function \hyperlink{namespacemakeopticalelements_a1b408449683f6bcc96ee25d4bbc1aa8b}{abt} (i, j, ft, nspec)
\begin{DoxyCompactList}\small\item\em calculates matrix elements Alpha-\/\+Beta$\ast$$\ast$T  for M = (A B ) (B$\ast$ A$\ast$) computes A\+B$\ast$$\ast$T and returns the i,j-\/th element \end{DoxyCompactList}\item 
complex(kind=dp) function \hyperlink{namespacemakeopticalelements_a7d0e54a1c7f830fd961f3c99d0a49b30}{bbd} (i, j, ft, nspec)
\begin{DoxyCompactList}\small\item\em calculates the matrix elements Beta$\ast$\+Beta$\ast$$\ast$H  for M = (A B ) (B$\ast$ A$\ast$) computes B$\ast$\+B$\ast$$\ast$H (Hermitian conjg) and returns the i,j-\/th element \end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemakeopticalelements_aefda61530c80eccf75e7065015af413d}{alloc\+\_\+temparrays} (nspace, nspec)
\begin{DoxyCompactList}\small\item\em allocates temp arrays for matrices \end{DoxyCompactList}\item 
subroutine \hyperlink{namespacemakeopticalelements_aab212aad9e53b7ae643456f9bc0b68cb}{dealloc\+\_\+temparrays}
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
real(kind=dp), public \hyperlink{namespacemakeopticalelements_ab4e48a98a0fb0756bb4eff6ece9623a8}{ident}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
module for building symplectic matrices for optical elements 

\subsection{Function/\+Subroutine Documentation}
\index{makeopticalelements@{makeopticalelements}!abt@{abt}}
\index{abt@{abt}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{abt(i, j, ft, nspec)}{abt(i, j, ft, nspec)}}]{\setlength{\rightskip}{0pt plus 5cm}complex(kind=dp) function makeopticalelements\+::abt (
\begin{DoxyParamCaption}
\item[{integer}]{i, }
\item[{integer}]{j, }
\item[{complex(kind=dp), dimension(\+:,\+:), intent(in), allocatable}]{ft, }
\item[{integer}]{nspec}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a1b408449683f6bcc96ee25d4bbc1aa8b}{}\label{namespacemakeopticalelements_a1b408449683f6bcc96ee25d4bbc1aa8b}


calculates matrix elements Alpha-\/\+Beta$\ast$$\ast$T  for M = (A B ) (B$\ast$ A$\ast$) computes A\+B$\ast$$\ast$T and returns the i,j-\/th element 


\begin{DoxyParams}{Parameters}
{\em i} & input index 1 \\
\hline
{\em j} & input index 2 \\
\hline
{\em ft} & input symplectic transform matrix for the optical circuit \\
\hline
{\em nspec} & input number of spectral D\+OF \\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000001}{Todo}]check this \end{DoxyRefDesc}
\index{makeopticalelements@{makeopticalelements}!alloc\+\_\+temparrays@{alloc\+\_\+temparrays}}
\index{alloc\+\_\+temparrays@{alloc\+\_\+temparrays}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{alloc\+\_\+temparrays(nspace, nspec)}{alloc_temparrays(nspace, nspec)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine makeopticalelements\+::alloc\+\_\+temparrays (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{nspace, }
\item[{integer, intent(in)}]{nspec}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_aefda61530c80eccf75e7065015af413d}{}\label{namespacemakeopticalelements_aefda61530c80eccf75e7065015af413d}


allocates temp arrays for matrices 


\begin{DoxyParams}{Parameters}
{\em nspace} & input \\
\hline
{\em nspec} & input  allocates memory for ident\+\_\+spec a spectral size matrix for tensor producting.\\
\hline
\end{DoxyParams}
allocates mem for spatial\+\_\+work, array size of spatial modes

allocates mem for n\+\_\+work, work array size of alpha or beta in sympectic matrix \index{makeopticalelements@{makeopticalelements}!amp@{amp}}
\index{amp@{amp}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{amp(a)}{amp(a)}}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=dp) function makeopticalelements\+::amp (
\begin{DoxyParamCaption}
\item[{complex(kind=dp)}]{a}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a0649740479f47221d009b8d496b78c8b}{}\label{namespacemakeopticalelements_a0649740479f47221d009b8d496b78c8b}


returns the absolute value squared $\vert$a$\vert$$\ast$$\ast$2 


\begin{DoxyParams}{Parameters}
{\em a} & input complex number to be $\vert$a$\vert$$\ast$$\ast$2 \\
\hline
\end{DoxyParams}
\index{makeopticalelements@{makeopticalelements}!bbd@{bbd}}
\index{bbd@{bbd}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{bbd(i, j, ft, nspec)}{bbd(i, j, ft, nspec)}}]{\setlength{\rightskip}{0pt plus 5cm}complex(kind=dp) function makeopticalelements\+::bbd (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{i, }
\item[{integer, intent(in)}]{j, }
\item[{complex(kind=dp), dimension(\+:,\+:), intent(in), allocatable}]{ft, }
\item[{integer, intent(in)}]{nspec}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a7d0e54a1c7f830fd961f3c99d0a49b30}{}\label{namespacemakeopticalelements_a7d0e54a1c7f830fd961f3c99d0a49b30}


calculates the matrix elements Beta$\ast$\+Beta$\ast$$\ast$H  for M = (A B ) (B$\ast$ A$\ast$) computes B$\ast$\+B$\ast$$\ast$H (Hermitian conjg) and returns the i,j-\/th element 


\begin{DoxyParams}{Parameters}
{\em i} & input index 1 \\
\hline
{\em j} & input index 2 \\
\hline
{\em ft} & input symplectic transform matrix for the optical circuit \\
\hline
{\em nspec} & input number of spectral D\+OF \\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000002}{Todo}]check this \end{DoxyRefDesc}
\index{makeopticalelements@{makeopticalelements}!dealloc\+\_\+temparrays@{dealloc\+\_\+temparrays}}
\index{dealloc\+\_\+temparrays@{dealloc\+\_\+temparrays}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{dealloc\+\_\+temparrays}{dealloc_temparrays}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine makeopticalelements\+::dealloc\+\_\+temparrays (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_aab212aad9e53b7ae643456f9bc0b68cb}{}\label{namespacemakeopticalelements_aab212aad9e53b7ae643456f9bc0b68cb}
\index{makeopticalelements@{makeopticalelements}!f\+\_\+gauss@{f\+\_\+gauss}}
\index{f\+\_\+gauss@{f\+\_\+gauss}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{f\+\_\+gauss(w1, w2, sigma1, sigma2, w1off, w2off)}{f_gauss(w1, w2, sigma1, sigma2, w1off, w2off)}}]{\setlength{\rightskip}{0pt plus 5cm}complex(kind=dp) function makeopticalelements\+::f\+\_\+gauss (
\begin{DoxyParamCaption}
\item[{real(kind=dp), intent(in)}]{w1, }
\item[{real(kind=dp), intent(in)}]{w2, }
\item[{real(kind=dp), intent(in)}]{sigma1, }
\item[{real(kind=dp), intent(in)}]{sigma2, }
\item[{real(kind=dp), intent(in)}]{w1off, }
\item[{real(kind=dp), intent(in)}]{w2off}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_ae29454e6b6a33b50212c3af0c275173a}{}\label{namespacemakeopticalelements_ae29454e6b6a33b50212c3af0c275173a}


J\+SA function taking two freq. 


\begin{DoxyParams}{Parameters}
{\em w1} & input signal freq \\
\hline
{\em w2} & input idler freq \\
\hline
{\em sig} & input variance \\
\hline
\end{DoxyParams}
\index{makeopticalelements@{makeopticalelements}!f\+\_\+sine@{f\+\_\+sine}}
\index{f\+\_\+sine@{f\+\_\+sine}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{f\+\_\+sine(w1, w2, sigma1, sigma2, w1off, w2off)}{f_sine(w1, w2, sigma1, sigma2, w1off, w2off)}}]{\setlength{\rightskip}{0pt plus 5cm}complex(kind=dp) function makeopticalelements\+::f\+\_\+sine (
\begin{DoxyParamCaption}
\item[{real(kind=dp), intent(in)}]{w1, }
\item[{real(kind=dp), intent(in)}]{w2, }
\item[{real(kind=dp), intent(in)}]{sigma1, }
\item[{real(kind=dp), intent(in)}]{sigma2, }
\item[{real(kind=dp), intent(in)}]{w1off, }
\item[{real(kind=dp), intent(in)}]{w2off}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_ac31d9c650a776cc4ebd4de3bcc370207}{}\label{namespacemakeopticalelements_ac31d9c650a776cc4ebd4de3bcc370207}
\index{makeopticalelements@{makeopticalelements}!g4@{g4}}
\index{g4@{g4}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{g4(ft, nspec)}{g4(ft, nspec)}}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=dp) function makeopticalelements\+::g4 (
\begin{DoxyParamCaption}
\item[{complex(kind=dp), dimension(\+:,\+:), intent(in), allocatable}]{ft, }
\item[{integer, intent(in)}]{nspec}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_af1a18704c55aa2efeb60157c81a80723}{}\label{namespacemakeopticalelements_af1a18704c55aa2efeb60157c81a80723}


calculates g4 using matrix elements sum  


\begin{DoxyParams}{Parameters}
{\em ft} & input is the full symplectic transform \\
\hline
{\em nspec} & input spectral D\+OF \\
\hline
\end{DoxyParams}
\index{makeopticalelements@{makeopticalelements}!gen\+\_\+jsa@{gen\+\_\+jsa}}
\index{gen\+\_\+jsa@{gen\+\_\+jsa}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{gen\+\_\+jsa(f, w1\+\_\+start, w1\+\_\+steps, w1\+\_\+incr, w2\+\_\+start, w2\+\_\+steps, w2\+\_\+incr, sigma1, sigma2, outfile, w1offset, w2offset)}{gen_jsa(f, w1_start, w1_steps, w1_incr, w2_start, w2_steps, w2_incr, sigma1, sigma2, outfile, w1offset, w2offset)}}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=dp) function, dimension (\+:,\+:), allocatable makeopticalelements\+::gen\+\_\+jsa (
\begin{DoxyParamCaption}
\item[{complex(kind=dp)}]{f, }
\item[{real(kind=dp), intent(in)}]{w1\+\_\+start, }
\item[{integer}]{w1\+\_\+steps, }
\item[{real(kind=dp), intent(in)}]{w1\+\_\+incr, }
\item[{real(kind=dp), intent(in)}]{w2\+\_\+start, }
\item[{integer}]{w2\+\_\+steps, }
\item[{real(kind=dp), intent(in)}]{w2\+\_\+incr, }
\item[{real(kind=dp), intent(in)}]{sigma1, }
\item[{real(kind=dp), intent(in)}]{sigma2, }
\item[{integer}]{outfile, }
\item[{real(kind=dp), optional}]{w1offset, }
\item[{real(kind=dp), optional}]{w2offset}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a230fa3e5fad58bf78ec6aecff5747ca6}{}\label{namespacemakeopticalelements_a230fa3e5fad58bf78ec6aecff5747ca6}


samples the given jsa for frequency ranges w1, w2 


\begin{DoxyParams}{Parameters}
{\em f\+\_\+mat} & allocatable Jsa matrix values out \\
\hline
{\em w\+\_\+start} & \\
\hline
\end{DoxyParams}
\index{makeopticalelements@{makeopticalelements}!make\+\_\+bs@{make\+\_\+bs}}
\index{make\+\_\+bs@{make\+\_\+bs}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{make\+\_\+bs(nspace, nspec, symp\+\_\+mat, m1, m2, theta)}{make_bs(nspace, nspec, symp_mat, m1, m2, theta)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine makeopticalelements\+::make\+\_\+bs (
\begin{DoxyParamCaption}
\item[{integer}]{nspace, }
\item[{integer}]{nspec, }
\item[{complex(kind=dp), dimension(\+:,\+:), allocatable}]{symp\+\_\+mat, }
\item[{integer}]{m1, }
\item[{integer}]{m2, }
\item[{real(kind=dp)}]{theta}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a593a6ee34afdeebc8b4667791c8a144f}{}\label{namespacemakeopticalelements_a593a6ee34afdeebc8b4667791c8a144f}


makes beamsplitter symplectic matrix  takes in an allocated matrix for the beamsplitter matrix to be written to uses the private ident\+\_\+spec, spatial\+\_\+work, n\+\_\+work arrays 


\begin{DoxyParams}{Parameters}
{\em nspace} & is number of total spatial modes \\
\hline
{\em nspec} & is number of total spectral modes \\
\hline
{\em m\+\_\+bs} & allocated n$\ast$n matrix for beamsplitter \\
\hline
{\em m1} & is spatial mode 1 for beam splitter \\
\hline
{\em m2} & is spatial mode 2 for beam splitter \\
\hline
\end{DoxyParams}
\index{makeopticalelements@{makeopticalelements}!make\+\_\+sq@{make\+\_\+sq}}
\index{make\+\_\+sq@{make\+\_\+sq}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{make\+\_\+sq(nspace, nspec, symp\+\_\+mat, m1, m2, alpha, beta)}{make_sq(nspace, nspec, symp_mat, m1, m2, alpha, beta)}}]{\setlength{\rightskip}{0pt plus 5cm}subroutine makeopticalelements\+::make\+\_\+sq (
\begin{DoxyParamCaption}
\item[{integer}]{nspace, }
\item[{integer}]{nspec, }
\item[{complex(kind=dp), dimension(\+:,\+:), allocatable}]{symp\+\_\+mat, }
\item[{integer}]{m1, }
\item[{integer}]{m2, }
\item[{complex(kind=dp), dimension(\+:,\+:), intent(inout)}]{alpha, }
\item[{complex(kind=dp), dimension(\+:,\+:), intent(inout)}]{beta}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_a6658c2ce879c0bc4b2e5918064a6a308}{}\label{namespacemakeopticalelements_a6658c2ce879c0bc4b2e5918064a6a308}


make symplectic squeezing matrix from exponetiated J\+SA  a lot is broken... 

\begin{DoxyNote}{Note}
only works if modes are consectutive 
\end{DoxyNote}
\begin{DoxyNote}{Note}
alpha \& beta are 2 spatial modes and all spectral modes dim 2$\ast$nspace$\ast$nspec
\end{DoxyNote}
loop for alpha

check this is legal... full diag sq symp\+\_\+mat(m1s\+:m1s+nspec, m1s+n\+:m1s+nspec+n)=beta(1\+:nspec, 1+nspec\+:2$\ast$nspec)

probably not legal symp\+\_\+mat(m2s\+:m2s+nspec, m2s+n\+:m2s+nspec+n)=beta(nspec+1\+:2$\ast$nspec, 1\+:nspec)

loop for beta, offset to col+n \index{makeopticalelements@{makeopticalelements}!make\+\_\+squeezer@{make\+\_\+squeezer}}
\index{make\+\_\+squeezer@{make\+\_\+squeezer}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{make\+\_\+squeezer(nspace, nspec, mode1, mode2, jsa)}{make_squeezer(nspace, nspec, mode1, mode2, jsa)}}]{\setlength{\rightskip}{0pt plus 5cm}complex(kind=dp) function, dimension(\+:,\+:), allocatable makeopticalelements\+::make\+\_\+squeezer (
\begin{DoxyParamCaption}
\item[{integer, intent(in)}]{nspace, }
\item[{integer, intent(in)}]{nspec, }
\item[{integer, intent(in)}]{mode1, }
\item[{integer, intent(in)}]{mode2, }
\item[{complex(kind=dp), dimension(\+:,\+:), intent(in), allocatable}]{jsa}
\end{DoxyParamCaption}
)}\hypertarget{namespacemakeopticalelements_ae72bdfe443e711e230a7bf9c19d827d4}{}\label{namespacemakeopticalelements_ae72bdfe443e711e230a7bf9c19d827d4}


make sqq matrix from jsa function 

\begin{DoxyNote}{Note}
to make off diagonal for fmatrix m\+\_\+sq=0.\+0\+\_\+dp ! top right m\+\_\+sq(1\+:1$\ast$f\+\_\+size, 3$\ast$f\+\_\+size+1\+:4$\ast$f\+\_\+size)=1 ! mid right m\+\_\+sq(1$\ast$f\+\_\+size+1\+:2$\ast$f\+\_\+size, 2$\ast$f\+\_\+size+1\+:3$\ast$f\+\_\+size)=2 ! mid left m\+\_\+sq(2$\ast$f\+\_\+size+1\+:3$\ast$f\+\_\+size, 1$\ast$f\+\_\+size+1\+:2$\ast$f\+\_\+size)=3 ! bot left m\+\_\+sq(3$\ast$f\+\_\+size+1\+:4$\ast$f\+\_\+size, 1\+:1$\ast$f\+\_\+size)=4

!h= 0.\+0 F\+\_\+\+J\+SA F\+\_\+\+J\+S\+A$\ast$T 0.\+0
\end{DoxyNote}
f\+\_\+jsa = f\+\_\+mat

M\+\_\+sq = exp(i ( 0 H ) (-\/\+H$\ast$ 0)

M\+\_\+sq = exp(i (0 0 0 F\+\_\+\+J\+SA) (0 0 F\+\_\+\+J\+S\+A$\ast$$\ast$T 0) (0 -\/conjg(F\+\_\+\+J\+SA) 0 0) (-\/\+F\+\_\+\+J\+S\+A$\ast$$\ast$H 0 0 0)

\begin{DoxyNote}{Note}
alpha beta are top left and top right of M M = (A B ) (B$\ast$ A$\ast$) 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em alpha\+\_\+size} & is 2$\ast$f\+\_\+size as all spectral modes for 2 spatial\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
allocate for sq on modes 1\&2 
\end{DoxyNote}


\subsection{Variable Documentation}
\index{makeopticalelements@{makeopticalelements}!ident@{ident}}
\index{ident@{ident}!makeopticalelements@{makeopticalelements}}
\subsubsection[{\texorpdfstring{ident}{ident}}]{\setlength{\rightskip}{0pt plus 5cm}real(kind=dp), public makeopticalelements\+::ident}\hypertarget{namespacemakeopticalelements_ab4e48a98a0fb0756bb4eff6ece9623a8}{}\label{namespacemakeopticalelements_ab4e48a98a0fb0756bb4eff6ece9623a8}
